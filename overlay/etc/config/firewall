    config defaults
        option  input                 'DROP'
        option  output                'ACCEPT'
        option  forward               'ACCEPT'

    config zone
            option name             wan
            option   network        'wan'
            option input            ACCEPT
            option output           ACCEPT
            option  masq        '1'
            option  mtu_fix     '1'

    config zone
            option name             infra
            option network          'infra'
            option input            ACCEPT
            option output           ACCEPT

    config zone
            option name             ap
            option network          'ap'
            option input            ACCEPT
            option output           ACCEPT

    # We need to accept udp packets on port 68,
    # see https://dev.openwrt.org/ticket/4108
    config rule
            option name             Allow-DHCP-Renew
            option src              wan
            option proto            udp
            option dest_port        68
            option target           ACCEPT
            option family           ipv4

    # Allow IPv4 ping
    config rule
            option name             Allow-Ping
            option src              wan
            option proto            icmp
            option icmp_type        echo-request
            option family           ipv4
            option target           ACCEPT

    config rule
            option name             Allow-IGMP
            option src              wan
            option proto            igmp
            option family           ipv4
            option target           ACCEPT

    # Allow DHCPv6 replies
    # see https://dev.openwrt.org/ticket/10381
    config rule
            option name             Allow-DHCPv6
            option src              wan
            option proto            udp
            option src_ip           fc00::/6
            option dest_ip          fc00::/6
            option dest_port        546
            option family           ipv6
            option target           ACCEPT

    config rule
            option name             Allow-MLD
            option src              wan
            option proto            icmp
            option src_ip           fe80::/10
            list icmp_type          '130/0'
            list icmp_type          '131/0'
            list icmp_type          '132/0'
            list icmp_type          '143/0'
            option family           ipv6
            option target           ACCEPT

    # Allow essential incoming IPv6 ICMP traffic
    config rule
            option name             Allow-ICMPv6-Input
            option src              wan
            option proto    icmp
            list icmp_type          echo-request
            list icmp_type          echo-reply
            list icmp_type          destination-unreachable
            list icmp_type          packet-too-big
            list icmp_type          time-exceeded
            list icmp_type          bad-header
            list icmp_type          unknown-header-type
            list icmp_type          router-solicitation
            list icmp_type          neighbour-solicitation
            list icmp_type          router-advertisement
            list icmp_type          neighbour-advertisement
            option limit            1000/sec
            option family           ipv6
            option target           ACCEPT

    # Allow essential forwarded IPv6 ICMP traffic
    config rule
            option name             Allow-ICMPv6-Forward
            option src              wan
            option dest             *
            option proto            icmp
            list icmp_type          echo-request
            list icmp_type          echo-reply
            list icmp_type          destination-unreachable
            list icmp_type          packet-too-big
            list icmp_type          time-exceeded
            list icmp_type          bad-header
            list icmp_type          unknown-header-type
            option limit            1000/sec
            option family           ipv6
            option target           ACCEPT

    # include a file with users custom iptables rules
    config include
            option path /etc/firewall.user
